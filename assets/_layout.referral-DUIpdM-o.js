import{r,j as e}from"./index-gtzDq4NN.js";import{y as n}from"./globalDisconnect-DEHmIGkh.js";import{u as H,a as J}from"./useAuth-RM4Avg_6.js";import{u as Q}from"./DexContext-BUFcSEJ_.js";import{u as Z}from"./OrderlyKeyContext-Bc8PuPFV.js";import{u as ee,g as se,a as re}from"./ModalContext-3rcxIYCP.js";import{C as o,B as x}from"./Card-DzC9HQ_p.js";import{W as ae}from"./WalletConnect-Bv6-w7CX.js";import{L as g}from"./components-CyfABTTb.js";import"./index-BftLqECp.js";import"./tslib.es6-DjQuqsdl.js";import"./switchMap-CAkRPEGC.js";import"./apiClient-Br2nePLb.js";import"./index--NnR_BUb.js";import"./clsx.m-DHulAg21.js";import"./iconify-AJT-F7UA.js";import"./index-B6zKOWfM.js";import"./index-Dvs6MNyz.js";function ve(){const{isAuthenticated:_,isLoading:X}=H(),{dexData:L,brokerId:w,isGraduated:P}=Q(),{orderlyKey:d,accountId:a,hasValidKey:c,setOrderlyKey:K}=Z(),{openModal:k}=ee(),{address:V}=J(),[R,f]=r.useState(!1),[T,D]=r.useState(!1),[S,C]=r.useState(!1),[t,E]=r.useState(null),[A,b]=r.useState(1e4),[m,p]=r.useState(20),[q,j]=r.useState(50),[F,y]=r.useState(""),[i,N]=r.useState(!0),[h,u]=r.useState(null),G=m>0?100/m:1,v=Math.round(m*q/100),M=m-v,O=s=>s<=0?"Max rebate must be greater than 0%":s>100?"Max rebate cannot exceed 100%":null,B=s=>{p(s);const l=O(s);u(l)};r.useEffect(()=>{c&&a&&d&&I()},[c,a,d]);const I=async()=>{if(!(!c||!a||!d)){D(!0);try{const s=await se(a,d);if(!s){E(null),b(1e4),p(20),u(null),j(50),y(""),N(!1);return}E(s),b(s.required_trading_volume);const l=s.max_rebate*100;p(l),u(null);const W=s.referrer_rebate*100,z=l>0?W/l*100:50;j(Math.round(z)),y(s.description),N(s.enable)}catch(s){console.error("Failed to load referral info:",s),n.error("Failed to load referral settings")}finally{D(!1)}}},U=async()=>{if(!V||!w||!a){n.error("Missing required information for key creation");return}f(!0);try{k("orderlyKeyLogin",{onSuccess:s=>{K(s),n.success("Orderly key created successfully!")},onCancel:()=>{f(!1)},brokerId:w,accountId:a})}catch(s){console.error("Failed to create orderly key:",s),n.error("Failed to create orderly key")}finally{f(!1)}},Y=async()=>{if(!c||!a||!d){n.error("Orderly key required to save settings");return}const s=O(m);if(s){u(s),n.error("Please fix validation errors before saving");return}C(!0);try{const l={required_trading_volume:A,max_rebate:m/100,referrer_rebate:v/100,referee_rebate:M/100,enable:i,description:F};await re(a,d,l),n.success("Referral settings updated successfully!"),await I()}catch(l){console.error("Failed to save referral settings:",l),n.error("Failed to save referral settings")}finally{C(!1)}},$=()=>{if(!c||!d||!a){n.error("Orderly key required to access admin credentials");return}k("adminLogin",{orderlyKey:d,accountId:a})};return X?e.jsx("div",{className:"w-full h-[calc(100vh-64px)] flex items-center justify-center px-4 mt-26 pb-52",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"i-svg-spinners:pulse-rings-multiple h-12 w-12 mx-auto text-primary-light mb-4"}),e.jsx("div",{className:"text-base md:text-lg mb-2",children:"Loading Referral Settings"}),e.jsx("div",{className:"text-xs md:text-sm text-gray-400",children:"Please wait while we prepare your referral dashboard"})]})}):_?L?P?e.jsxs("div",{className:"container mx-auto p-4 max-w-3xl mt-26 pb-52",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:e.jsxs("div",{children:[e.jsxs(g,{to:"/dex",className:"text-sm text-gray-400 hover:text-primary-light mb-2 inline-flex items-center",children:[e.jsx("div",{className:"i-mdi:arrow-left h-4 w-4 mr-1"}),"Back to DEX Dashboard"]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold gradient-text",children:"Referral Settings"})]})}),e.jsxs("div",{className:"space-y-6",children:[!c&&e.jsx(o,{className:"border border-warning/20 bg-warning/5",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"bg-warning/20 p-2 rounded-full flex-shrink-0",children:e.jsx("div",{className:"i-mdi:key text-warning w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-warning",children:"Orderly Key Required"}),e.jsx("p",{className:"text-gray-300 mt-1 mb-4",children:"To manage referral settings, you need to create an Orderly key that allows secure API access to the Orderly Network. This key will be stored locally and used for managing your referral program."}),e.jsx(x,{onClick:U,disabled:R,className:"flex items-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-svg-spinners:pulse-rings-multiple w-4 h-4"}),"Creating Key..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-mdi:key-plus w-4 h-4"}),"Create Orderly Key"]})})]})]})}),c&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{children:[e.jsx("h2",{className:"text-xl font-medium mb-4",children:"Auto Referral Configuration"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Configure your automatic referral program settings. Users who meet the trading volume requirements will be automatically enrolled in your referral program."}),T?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"i-svg-spinners:pulse-rings-multiple w-8 h-8 text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background-dark/30 rounded-lg border border-light/10",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Auto Referral Program"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Enable automatic enrollment for users who meet trading requirements"})]}),e.jsx("button",{type:"button",onClick:()=>N(!i),className:`relative inline-flex h-6 w-12 flex-shrink-0 items-center rounded-full transition-colors ${i?"bg-primary":"bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-7":"translate-x-1"}`})})]}),e.jsxs("div",{className:`space-y-6 ${i?"":"opacity-60"}`,children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Required Trading Volume (USDC)"}),e.jsx("input",{type:"number",value:A,onChange:s=>b(Number(s.target.value)),className:"w-full px-3 py-2 rounded-lg bg-background-dark border border-light/10 text-white disabled:opacity-50 disabled:cursor-not-allowed",min:"0",step:"1000",disabled:!i}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Minimum trading volume required to join referral program"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Max Rebate (%)"}),e.jsx("input",{type:"number",value:m,onChange:s=>B(Number(s.target.value)),className:`w-full px-3 py-2 rounded-lg bg-background-dark border text-white disabled:opacity-50 disabled:cursor-not-allowed ${h?"border-error focus:border-error":"border-light/10 focus:border-primary"}`,min:"0",max:"100",step:"0.1",disabled:!i}),h?e.jsx("p",{className:"text-xs text-error mt-1",children:h}):e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Maximum rebate percentage for participants"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Default referrer rebate"}),e.jsxs("p",{className:"text-lg font-bold",children:[v,"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Default referee rebate"}),e.jsxs("p",{className:"text-lg font-bold",children:[M,"%"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"range",min:"0",max:"100",step:G,value:q,onChange:s=>j(Number(s.target.value)),disabled:!i,className:"w-full h-2 bg-gradient-to-r from-secondary to-primary rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed slider"}),e.jsx("style",{children:`
                          .slider::-webkit-slider-thumb {
                            appearance: none;
                            width: 20px;
                            height: 20px;
                            border-radius: 50%;
                            background: #ffffff;
                            cursor: pointer;
                            border: 2px solid rgb(176, 132, 233);
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                          }
                          .slider::-moz-range-thumb {
                            width: 20px;
                            height: 20px;
                            border-radius: 50%;
                            background: #ffffff;
                            cursor: pointer;
                            border: 2px solid rgb(176, 132, 233);
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
                          }
                        `})]}),e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Adjust the split between referrer and referee rebates. Total rebate: ",m,"%"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),e.jsx("textarea",{value:F,onChange:s=>y(s.target.value),className:"w-full px-3 py-2 rounded-lg bg-background-dark border border-light/10 text-white disabled:opacity-50 disabled:cursor-not-allowed",rows:3,placeholder:"Describe your referral program...",disabled:!i})]})]}),e.jsx("div",{className:"flex gap-3 pt-4",children:e.jsx(x,{onClick:Y,disabled:S||!!h,className:"flex items-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-svg-spinners:pulse-rings-multiple w-4 h-4"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-mdi:content-save w-4 h-4"}),"Save Settings"]})})})]})]}),t&&e.jsxs(o,{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Current Settings"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Trading Volume Required:"}),e.jsxs("span",{children:[t.required_trading_volume.toLocaleString()," ","USDC"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Max Rebate:"}),e.jsxs("span",{children:[(t.max_rebate*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Referrer Rebate:"}),e.jsxs("span",{children:[(t.referrer_rebate*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Referee Rebate:"}),e.jsxs("span",{children:[(t.referee_rebate*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:t.enable?"text-success":"text-warning",children:t.enable?"Enabled":"Disabled"})]})]})]}),t.description&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-light/10",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"Description:"}),e.jsx("p",{className:"text-sm mt-1",children:t.description})]})]}),e.jsx(o,{className:"bg-gradient-to-r from-primary/10 to-secondary/10 border border-primary/20",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"bg-primary/20 p-3 rounded-full flex-shrink-0",children:e.jsx("div",{className:"i-mdi:tools text-primary w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Advanced Referral Management"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"For more advanced referral features, you can use the Orderly Admin Dashboard which provides additional tools for managing your referral program."}),e.jsxs("div",{className:"bg-background-dark/50 p-4 rounded-lg border border-secondary-light/10 mb-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm text-secondary-light",children:"Additional features available:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:ticket-percent text-secondary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Create specific referral codes manually for targeted campaigns"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:chart-box text-secondary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Detailed analytics and performance tracking for referrals"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:account-group text-secondary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Advanced user management and referral relationship tracking"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:cog-box text-secondary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Fine-grained control over referral program parameters"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(x,{variant:"primary",onClick:()=>window.open("https://admin.orderly.network/","_blank"),className:"flex items-center gap-2",children:[e.jsx("div",{className:"i-mdi:open-in-new w-4 h-4"}),"Open Admin Dashboard"]}),e.jsxs(x,{variant:"secondary",onClick:$,disabled:!c,className:"flex items-center gap-2",children:[e.jsx("div",{className:"i-mdi:key w-4 h-4"}),"Get Login Credentials"]})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-400 flex items-start gap-1.5",children:[e.jsx("div",{className:"i-mdi:information-outline w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:'Use the same wallet that you used to set up your DEX to access your broker settings in the admin dashboard. Click "Get Login Credentials" to copy the required keys and account ID for login.'})]})]})]})})]})]})]}):e.jsxs("div",{className:"container mx-auto p-4 max-w-3xl mt-26 pb-52",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:e.jsxs("div",{children:[e.jsxs(g,{to:"/dex",className:"text-sm text-gray-400 hover:text-primary-light mb-2 inline-flex items-center",children:[e.jsx("div",{className:"i-mdi:arrow-left h-4 w-4 mr-1"}),"Back to DEX Dashboard"]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold gradient-text",children:"Referral Settings"})]})}),e.jsx(o,{className:"border border-warning/20 bg-warning/5",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"bg-warning/20 p-3 rounded-full flex-shrink-0",children:e.jsx("div",{className:"i-mdi:lock text-warning w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-warning mb-2",children:"Graduation Required"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Referral settings are only available for graduated DEXes. You need to graduate your DEX first to start earning revenue and enable referral programs."}),e.jsxs("div",{className:"bg-background-dark/50 p-4 rounded-lg border border-secondary-light/10 mb-6",children:[e.jsx("h4",{className:"font-semibold mb-2 text-secondary-light",children:"Why graduation is required:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:cash-multiple text-primary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Referrals are tied to revenue sharing from trading fees"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:account-group text-primary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Graduated DEXes can offer rebates and rewards to traders"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"i-mdi:shield-check text-primary w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Ensures your DEX has the necessary infrastructure for referrals"})]})]})]}),e.jsxs(x,{as:"a",href:"/dex/graduation",className:"flex items-center gap-2",children:[e.jsx("div",{className:"i-mdi:rocket-launch w-4 h-4"}),"Graduate Your DEX"]})]})]})}),e.jsxs(o,{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Preview: Referral Features"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Once your DEX is graduated, you'll have access to these referral management features:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-background-dark/30 border border-light/5",children:[e.jsx("div",{className:"i-mdi:percent text-secondary w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:"Auto Referral Program"}),e.jsx("p",{className:"text-gray-400",children:"Set trading volume thresholds and automatic rebate rates"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-background-dark/30 border border-light/5",children:[e.jsx("div",{className:"i-mdi:chart-line text-secondary w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:"Revenue Sharing"}),e.jsx("p",{className:"text-gray-400",children:"Configure referrer and referee rebate percentages"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-background-dark/30 border border-light/5",children:[e.jsx("div",{className:"i-mdi:cog text-secondary w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:"Program Management"}),e.jsx("p",{className:"text-gray-400",children:"Enable/disable programs and update settings in real-time"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-background-dark/30 border border-light/5",children:[e.jsx("div",{className:"i-mdi:shield-check text-secondary w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:"Secure API Access"}),e.jsx("p",{className:"text-gray-400",children:"Manage settings through secure Orderly Network integration"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-background-dark/30 border border-light/5",children:[e.jsx("div",{className:"i-mdi:tools text-secondary w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-1",children:"Advanced Dashboard"}),e.jsx("p",{className:"text-gray-400",children:"Access to Orderly Admin Dashboard for creating custom referral codes and detailed analytics"})]})]})]})]})]})]}):e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 py-6 md:py-10 mt-26 pb-52",children:e.jsxs("div",{className:"text-center",children:[e.jsxs(g,{to:"/dex",className:"text-sm text-gray-400 hover:text-primary-light mb-2 inline-flex items-center",children:[e.jsx("div",{className:"i-mdi:arrow-left h-4 w-4 mr-1"}),"Back to DEX Dashboard"]}),e.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold mb-4 md:mb-6",children:"Referral Settings"}),e.jsxs(o,{children:[e.jsx("h2",{className:"text-lg md:text-xl font-medium mb-3 md:mb-4",children:"No DEX Found"}),e.jsx("p",{className:"mb-4 md:mb-6 text-sm md:text-base text-gray-300",children:"You need to create a DEX first before you can set up referrals."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{to:"/dex",className:"btn-connect",children:"Create Your DEX"})})]})]})}):e.jsx("div",{className:"w-full max-w-3xl mx-auto px-4 py-6 md:py-10 mt-26 pb-52",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold mb-4 md:mb-6",children:"Referral Settings"}),e.jsxs(o,{children:[e.jsx("h2",{className:"text-lg md:text-xl font-medium mb-3 md:mb-4",children:"Authentication Required"}),e.jsx("p",{className:"mb-4 md:mb-6 text-sm md:text-base text-gray-300",children:"Please connect your wallet and login to access referral settings."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(ae,{})})]})]})})}export{ve as default};
